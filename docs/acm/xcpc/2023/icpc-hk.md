---
title: ICPC-hongkong
date: 2023-10-18 15:09:57
tags:
---

## [The 2023 ICPC Asia Hong Kong Regional Programming Contest (The 1st Universal Cup, Stage 2:Hong Kong)](https://codeforces.com/gym/104172)

### [B. Big Picture](https://qoj.ac/contest/1099/problem/5456)

#### Description

给你一个 $(n+1) \times (m+1)$ 的方格矩阵，每个格子一开始是白色。

你会对每一行和每一列进行染色。将第 $i$ 行的前 $j$ 个格子染为黑色的概率为 $p_{i, j}$，将第 $j$ 列的前 $i$ 个格子染为黑色的概率为 $q_{i, j}$。保证每一行的 $p_{i, j}$、每一列的 $q_{i, j}$ 的和为 1。行与列是独立的，这意味着同一个格子可能会同时被行和列各染一次。

求同色连通块的期望个数，模 $998244353$。

#### **Solution**

对于每一个染列的操作，我们发现每列第一个（即第一行）一定都会被染色。故所有由染列得到的黑格子都会经由第一行连在一起。

对于每一个染行的操作，我们发现每行第一个（即第一列）一定都会被染色。故所有由染行得到的黑格子都会经由第一列连在一起。

又因为第一行第一列的格子一定会被染色，所以所有黑格子一定都是一个大连通块。并且最后一行，最后一列一定都是白色格子，所以我们要算的就是被黑色格子断开所形成的白色区域个数。

要确定每一个区域的个数，我们只要找一个区域中有标志的格子（含有某个独一无二的特性，只有其中某个格子有，其他格子都没有）。我们自然想到找角落的格子。思考发现由于每次染前缀的特性，左上角，右上角，左下角符合条件的格子均可能不唯一，只有右下角的格子唯一。所以找区域个数变为找区域右下角格子的个数，即计算有多少个格子可能称为右下角格子。这个概率是该格子没被染色并且下面，右边均被染色。

[Code](https://codeforces.com/gym/104172/submission/228641466)

### [E. Goose, Goose, DUCK?](https://codeforces.com/gym/104172/problem/E)

#### Description

给定一个序列 $\{a_i\}$，对于一个子序列，若其**不合法**，当且仅当子序列中存在某个元素出现了**恰好** $k$ 次。求这个序列中有多少个**合法子序列**。

$n \le 10^6$

#### **Solution**

我们可以固定左端点，求有多少合法右端点。也可以固定右端点，求有多少合法左端点。

假设固定一个左端点，我们把右边所有不合法的区域全部标记 $+1$，初始时右边所有区域都是 $0$。题目就变为了求右边有多少个标记为 $0$ 的点。然后每次左端点都可以向右移动一位，移动的时候判断一下，如果这个元素右边区域剩的元素少于 $k$ 个，那么就不用标记 $-1$。反之把这个元素原先不合法的区域都变合法（即标记 $-1$ ），然后再把新的区域标记不合法（标记 $+1$ ）。

整个过程可以用线段树解决。时间复杂度 $\Theta (n\log n)$。

[Code](https://codeforces.com/gym/104172/submission/228673534)
