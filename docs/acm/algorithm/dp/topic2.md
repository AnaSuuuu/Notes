# DP 优化技巧

## 习题


[**CF2021D Boss, Thirsty**](https://codeforces.com/contest/2021/problem/D)

**Solution**

本题还是偏套路。

我们直接设 `f[i][l][r]` 表示选 $i$ 行的 $[l, r]$ 区间的最大价值，时间复杂度肯定是要爆的。我们可以把左右端点拆开。 

设 `f[i][l]` 表示选到第 $i$ 行以 $l$ 为左端点的最大价值，`g[i][r]` 表示选到第 $i$ 行以 $r$ 为右端点的最大价值。

我们发现相邻两行，若上一行选了 $[u, v]$，这一行选了 $[l, r]$，那么满足的充要条件是 $(l < u \le r) \vee (l \le v < r)$。所以我们有四组转移方程，分别是 $f_{i - 1} \to g_i, f_{i - 1} \to f_i, g_{i - 1} \to g_i, g_{i - 1} \to f_i$。

具体以 $f_{i - 1} \to f_i$ 为例说明一下。

$$
f_{i, l} = \max_{u = l + 1}^n\{f_{i - 1, u} + \max_{r = u}^n\{sum_r\}\} - sum_{j - 1}
$$

这里的 $\max_{r = u}^n\{sum_r\}$ 倒推维护，算是一个小 trick，每次 $f_{i, l}$ 只和新增的 $f_{i - 1, l + 1}$ 进行转移，并且这个转移方程转移的时候还要用后缀最大值来更新当前的 $f_{i, l}$。这样每一层的时间复杂度就是 $O(n)$，这个优化有点巧妙的。

